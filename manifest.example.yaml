# Execute actions
#
# Will make no modifications if set to false - only log what
#  actions would be taken.
#
# Default: false
# 
Execute: false

# Prefix for paths to:
#   * File sources
#   * Directory sources
#   * Symbollic link targets
#
# Accepts valid file paths, including:
#   * Shell variables currently in environment
#   * ./ for the location of this file
#
# Default: the current working directory
#
# Will be set to default if left blank or set to empty string.
#
Src_Relative_To: $HOME

# Prefix for paths to:
#   * File destinations
#   * Folder destinations
#   * Symbollic links (actual link, not target)
#   * Removals
# Accepts valid file paths, including:
#   * Shell variables currently in environment
#   * ./ for the location of this file
#
# Default: .dest directory in the current working directory
#
# Will be set to default if left blank or set to empty string.
#
Dest_Relative_To: ./.dest

# Package lookup backend to use:
#   * pacman
#   * dpkg
#   * homebrew
#   * pkgng
#   * ignore
#
# The special value ignore will assume all packages are installed.
#
# Default: attempt to autodetect, fallback to ignore.
#
# Will be set to default if left blank or set to empty string.
#
Pkg_Sys: ignore

# Backend to use:
#   * linux
#   * macos !! As of yet unsupported !!
#
# Default: attempt to autodetect, otherwise fails.
#
# Will attempt to autodetect if left blank or set to empty string.
#
Sys_Type: linux

# Defaults to use for each operation.
#
# Note: User and Group accept shell environment variables.
#
# Default: shown below.
#
# Will be set to default if left blank, or set to null-value
#  (empty string for strings, 0 for numbers or permission modes).
#
Defaults:
    Order: 100              # all operations start with this order value
    Dir_Mode: 0750          # files have user write, group read, other no access
    File_Mode: 0640         # directories have user write, group read, other no access
    User: '$MFST_USER'      # current owner for this manifest file.
                            # Note: will use shell environment variable if present, else
                            # lookup.
    Group: '$MFST_GROUP'    # current group for this manifest file
                            # Note: will use shell environment variable if present, else
                            # lookup.

# Operations to perform by type.
#
# Operations always happen in this order: removals, directories, files, and symlinks.
#
# Each type of operations waits until the previous type has completed successfully.
#
# Operations of each type with equal order value are done asynchronously
# but operations with a later order do not start until earlier ones complete.
#
# The first valid order value is 1.
#
# Specifying an array of hostnames will restrict that
# operation to matching hosts (case insensitive).
#
# Specifying an array of packages will restrict that
# operation to hosts with all packages installed (case insensitive).
#
# All operation types will default to empty if unset.
#

# Unconditionally remove a directory, file, or symlink.
#
# The PathToRemove is relative to the global DestRoot option, (default $HOME/.config).
#
Removals:
    # Remove ./.dest/intruders on all hosts.
    - Path_To_Remove: intruders

    # Remove ./.dest/warpcore on host enterprise, if the eject package is installed.
    - Path_To_Remove: warpcore
      If:
        Hosts: [enterprise]
        Pkgs: [eject]

# Synchronize the contents of the directory at DestinationPath to match exactly the contents
# of the directory at SourcePath with specified ownership and permissions.
#
# This operation will:
#   * Copy files from SourcePath to DestinationPath
#   * Remove files from DestinationPath not present in SourcePath
#   * Set the ownership and permissions as specified
#
# The SourcePath is relative to the global OriginRoot option.
# The DestinationPath is relative to the global DestRoot option.
#
# If only SourcePath is given, it will also be used as DestinationPath.
#
Directories:
    # Synchronize ./.dest/holodeck to match ./holodeck on all hosts.
    - Src_Path: holodeck

    # Synchronize ./.dest/bridge/panels to match ./panels/exploding
    # on hosts enterprise and defiant and set specific user, group, and
    # access permissions if the turbolift and transporter packages are
    # installed.
    - Src_Path: panels/exploding
      Dest_Path: bridge/panels
      User: numberone
      Group: officers
      Dir_Mode: 0755
      File_Mode: 0644
      If:
        Hosts: [enterprise, defiant]
        Pkgs: [turbolift, transporter]

    # Install ./.dest/sickbay from ./decks/sickbay first...
    - Src_Path: decks/sickbay
      Dest_Path: sickbay
      Order: 10

    # ... then install ./.dest/sickbay/beds and ./.dest/sickbay/meds.
    - Src_Path: beds
      Dest_Path: sickbay/beds
      Order: 11

    - Src_Path: meds
      Dest_Path: sickbay/meds
      Order: 11

# Copy the file at SourcePath to DestinationPath and set the file permissions.
#
# The SourcePath is relative to the global OriginRoot option.
# The DestinationPath is relative to the global TargetRoot option.
#
# NOTE: this WILL replace the file at DestinationPath.
#
# If only SourcePath is given, it will also be used as DestinationPath.
#
Files:
    # Copy ./bay/torpedo to ./.dest/bay/torpedo on all hosts.
    - Src_Path: bay/torpedo

    # Copy ./phaser to ./.dest/brig/phaser
    # and set the user, group, and access permissions,
    # on host defiant if the stun package is installed
    - Src_Path: phaser
      Dest_Path: brig/phaser
      User: warf
      Group: security
      File_Mode: 0600
      If:
        Hosts: [defiant]
        Pkgs: [stun]

# Create a symbollic link (symlink) at LinkPath pointing to TargetPath.
#
# The LinkPath is relative to the global DestRoot option.
# The TargetPath is relative to the global OriginRoot.
#
# NOTE: this WILL replace any file at TargetPath.
#
Symlinks:
    # Create a symlink at ./.dest/drink pointing to ./tea/earlgray/hot on all hosts.
    - Link_Path: drink
      Target_Path: tea/earlgray/hot

    # Create a symlink at ./.dest/hypospray pointing to ./hyposprays/norepinephrine
    # on host enterprise if the sickbay package is installed.
    - Link_Path: hypospray
      Target_Path: hyposprays/norepinephrine
      If:
        Hosts: [enterprise]
        Pkgs: [sickbay]

